
---
title: homelab 折腾
date: 2022-04-05 23:32
tags: 
categories: 
description: 
---

## homelab

homelab 该怎么玩？

8T的数据够不够用，前期不上raid, 要怎么玩？

[苏洋有相关的开源与积累](https://github.com/soulteary/Home-Network-Note)

所谓的操作快，还是下意识动作，明明思考一下，击键少了，也更准确了，就是不愿意使用, 这样的习惯并不好。高效的方式还是需要多使用才能达到肌肉记忆的地步。

## NAS 构建 

使用现有的电脑即可, 功耗过高，就加一个远程控制开关，需要的时候再开启

需要额外做的工作是，各系统以及各应用都是在开机后正常启动。

软路由，专门的软路由迷你主机，好像性能也不够用？
还是要搞nas, 家里的那个机箱也有些大了。
真跟电费比起来，好像买个服务器确实不贵啊

单独买个软路由的问题是，害怕性能不够, 如果只是用来拨号上网的话，确实用不上性能那么强的。
挂一个翻墙的软路由还是有必要的, 很实用，就怕流量不够，但是现在就我的使用量看来也是够的。
那就再买个软路由试试水吧，内网交换还是可以加个交换机的

每年在这上面的投资还是不小哇，在家里搞软件总是分心。

现在的旧电脑问题，机器过大，功耗是个问题

纠结，主要还是没钱。。。

使用台式机的话，还需要加张网卡，而且机箱也装不进去，软路由的话，双口的还要再加个交换机, 四口的话，交换机也不需要了
所以，找一台性能能满足千兆内网的低功耗软路由, 价线相比两口的差一个网卡，一个交换机的钱就行。

一步步来，先用手上的工具折腾，随着需求一步步加。

Tue Oct 10 10:17:47 2023 Tuesday

纠结来纠结去的， 为了2000多块钱，耽误了几个月的时间, 配置一个新的

也不必配置太高，先搞一个NAS，主要用来分享数据，

## 配置

不要急躁，慢慢组
精粤主板，寨厂
机箱是没想到的，比普通机箱要贵得多
没有必要非得上itx 机箱啊, 上一个matx, 可选性就大得多, 也便宜一些

纠结的主要原因是，定位不清楚，高性能与够用，明显现在我的主要需求是够用即可，主要是图片，代码，影音, 剪辑的需求

选了一天的配置， 为什么不使用raid? 都是因为钱的问题 

太高的配置超预算，低的配置又看不上，好像现有的电脑也能凑合用一用。
那就先用现有的用着吧，不够了再升级

nas 的核心需求: 

	图片同步功能, 备份

其次： 

	影音服务， 图床
	gitlab

也可以不需要阵列，写一个定期同步的工具, 将重要的文件同步即可

内网穿透，动态DNS解析

交换机到了就可以尝试了

samba服务，是否可以做到文件共享，自动备份

图片管理

docker 部署 单网口软路由

影音系统

温度监控

日常工具配置
zsh, vim配置

gitlab搭建

自动下载工具

图书馆

### 影音资源积累

动画片

英语

纪录片

### 网站

### 软路由

主机是一个网口，暂不投入更多去搞软路由，后面有需求再扩展。

所以，回家先搞一个单机的问题

# Sun Oct  1 06:17:03 2023 Sunday
## review
折腾了一年半，也没有正常投入使用，有点失败啊。

格式化成zfs，到时候，即时系统盘没挂，数据盘也应该不成问题的

没有必要上raid, 正确的方式还是定时备份核心数据，当然，商用的就不一样了。

有没有必要非得去使用 TrueNas, 群晖这样专门的NAS系统去备份数据呢？ 在熟悉使用linux的前提下，感觉还真没有必要

所以，直接尝试使用ubuntu也是个不错的选择。

为什么不使用archlinux 呢？还是没有那么多时间去折腾。满足需求够用即可。

要不要尝试freeBsd试试呢？相对来说，还是对ubuntu熟悉一些，主要是源有国内可替代的

还是直接使用TrueNas吧，在TrueNas上的折胶经验也未必不适用于其他Linux系统, 至少先接触一下可商用的系统是什么样子

Thu Oct 12 00:56:21 2023 Thursday

想怎么记录呢？
之前记录了一些废话，现在再整理，也没什么意思

服务器，sshd, 环境，看来，是真需要备份一个镜像

按照目标优先级，一个个搞吧。

有啥问题，按顺序记录下来

创建用户，后续的应用都是根据用户来给权限的

- tasks

照片同步
	photoprism
	syncthing

	我想的同步方案，早已有很多人实现了啊
	photoprism是用来index 分析展示的
	syncthing 是用来同步的，可以共用同一个文件夹，但是需要跑index脚本

	如何在TrueNAS 主动跑 photoprism 的同步任务
	syncthing 的配置，中继服务器，还有其他的服务器
	dupilicati 是否与syncthing 功能重复了，有必要两都都配置么?
	TrueNas没有现成的Duplicati容器，如何手动装容器呢？

	syncthing 在非局域网里传输需要中继服务器，除了建立连接，后续传输的文件经不经过中继服务器？
	如果经过的话，中继服务器的流量能否抗得住？ 如果不经过的话，是什么技术实现的呢？
	应该是经过的
	
	P2P是必须有公网IP的情下点对点传输吗？如果没有公网IP，则必须经过中继服务器吗？
	这样看得话，P2P好像也并不是万能的, 手机网络可以使用P2P技术吗？

	为什么非得开着音乐工作呢？ 
	如何规划任务
	
gitlab

	gitlab 搭建

备份

	核心重要的数据备份有哪些？ 图片，代码

	备份方案是什么？主力电脑需要一个备份，再需要一个移动硬盘备份。不是特别重要的，也可以放在网盘上备份。

	电脑上还需要一块大的硬盘。用来存储网络资源。

	需要几个盘备份，
	
	退还电脑，数据需要清理，这是常识了，并不是离职才清数据。

资源下载

	先下载好资源，再考虑如何将资源合理展示的问题

	家里的公网IP，好像还真没那么容易变, 能不能拉更高的宽带呢？小区为什么就不能拉呢？
	混成什么样了哦，老家里的人，谁记得你的好呢？
	泥菩萨过河，自身难保啊。
	
blog 的证书又没用了，看来crontab 还真没有用啊。
这块有必要写个具体的步骤, 每三个月搞一下，也是有些难顶。

腾讯云，开放了权限，还是可以搞事情的。

syncthing, 还需要了解p2p 技术，搞定后，从哪里下载资源呢？


## 如何将nas 暴露到公网呢？

有固定的公网IP将会容易得多
我的情况是，有公网IP，但是也会变
使用nc 的方式，监听一个端口，定时获取ip 传过来
获取IP的方式 `curl ip.sb`
还需要路由器支持, 网络确实是一门大学问

这里有很多方法，可以自架一个NAS服务器, 姑且先这样实现吧

